# ベースイメージ
FROM node:18-alpine AS base

# 作業ディレクトリを設定
WORKDIR /app

# 依存関係のインストール
FROM base AS deps
COPY frontend/package.json frontend/package-lock.json ./
RUN npm ci

# ビルド
FROM base AS build
COPY --from=deps /app /app
COPY frontend .
RUN npm run build

# 実行環境のセットアップ
FROM node:18-alpine AS production
WORKDIR /app
COPY --from=build /app /app
ENV NODE_ENV=production
EXPOSE 3000
CMD ["npm", "start"]
